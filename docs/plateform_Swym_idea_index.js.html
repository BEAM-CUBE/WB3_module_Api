<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: plateform/Swym/idea/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: plateform/Swym/idea/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { _httpCallAuthenticated, _3dswym_get_version } from "@/plugins";

import { mainStore } from "@/store";

/*
 * @exemple
 */
const dataTest = {
  title: "TEST DEV COMMUNITY IDEA", // titre du post
  community_id: "YXdA5x4DSUKtlAi2wmnyTA", // STATUT PROJETS - Phase commerciale,  tenant PIVETEAU TEST
  community_title: "TEST DEV COMMUNITY", // Possibilité de recherche par titre de la communauté (option)
  idee_id: "THhRI8rlQNWKRxpv3Xqqug", // id de l'idee qui est créer au post (_3dSwym_postIdea)
};

/**
 * @description
 * La fonction `_3dswym_postIdea` est utilisée pour publier une idée dans une communauté 3DExperience.
 * @param {Object} [data] - Le paramètre `data` est un objet qui contient les propriétés suivantes: `title`, `community_id` et `community_title` Ce dernier est optionnel.
 * @param {Callback} [onDone] - Le paramètre `onDone` est une fonction de rappel qui sera appelée lorsque l'idée
 * sera publiée avec succès. Il prend un argument, «info», qui contient les données de réponse du
 * serveur.
 * @param {Callback} [onError] - Le paramètre `onError` est une fonction de rappel qui sera appelée s'il y a une
 * erreur lors de l'exécution de la fonction `_3dswym_postIdea`. Il vous permet de gérer toutes les
 * erreurs qui surviennent et d'effectuer toutes les actions nécessaires.
 */
export function _3dSwym_postIdea(
  data,
  onDone = undefined,
  onError = undefined,
) {
  const store = mainStore();
  const { _3DSwym, swymCommunities } = store;
  const URL = `${_3DSwym}/api/idea/add`;

  const findByID = swymCommunities.find(
    (commu) => commu.id === data.community_id,
  );
  const findByTitle = swymCommunities.find(
    (commu) => commu.title.toLowerCase() === data.community_title.toLowerCase(),
  );

  console.log(findByID, findByTitle);

  const formatedData = {
    params: {
      title: data.title, // String, le nom de l'affaire
      community_id: findByID?.id !== undefined ? findByID.id : findByTitle.id, // String, l'id de la communauté
      message: templateAffaireMessage(), // STRING =>  le contenue du message doit être au format HTML
      published: 1, // 1 publier, 0 non publier
    },
  };
  _3dswym_get_version((token) => {
    const headers = {
      "Content-type": "application/json;charset=UTF-8",
      Accept: "application/json",
      "X-DS-SWYM-CSRFTOKEN": token.result.ServerToken,
    };
    console.log("j'envois la donnée", formatedData);
    _httpCallAuthenticated(URL, {
      method: "POST",
      headers: headers,
      data: JSON.stringify(formatedData),
      type: "json",
      onComplete(response, headers, xhr) {
        let info = response;
        if (typeof info === "string") {
          info = JSON.parse(info);
        }
        console.log("✔️ postIdea => ", info);
        console.log("✔️ postIdea => ", headers);
        console.log("✔️ postIdea => ", xhr);

        if (onDone) onDone(info);
      },
      onFailure(response, headers, xhr) {
        console.log("☠️ error => ", response);
        console.log("☠️ error => ", headers);
        console.log("☠️ error => ", xhr);
        if (onError) onError(response);
      },
    });
  });
}

/**
 * @description
 * La fonction `_3dSwym_deleteIdea` permet de supprimer une idée dans une communauté 3D Swym.
 * @param {Object} [data] - Le paramètre `data` est un objet qui contient les propriétés suivantes: `community_id` et `ideationIds`
 */
export function _3dSwym_deleteIdea(data) {
  const store = mainStore();
  const { _3DSwym } = store;
  const URL = `${_3DSwym}/api/idea/delete`;
  const formatedData = {
    params: {
      community_id: data.community_id,
      ideationIds: [data.idee_id],
    },
  };
  _3dswym_get_version((token) => {
    _httpCallAuthenticated(URL, {
      method: "POST",
      headers: {
        "Content-type": "application/json;charset=UTF-8",
        Accept: "application/json",
        "X-DS-SWYM-CSRFTOKEN": token.result.ServerToken,
      },
      data: JSON.stringify(formatedData),
      type: "json",
      onComplete(response, headers, xhr) {
        const info = response;
        console.log("✔️ deleteIdea => ", info);
        console.log("✔️ postIdea => ", xhr.status);
      },
      onFailure(response, headers, xhr) {
        console.log("☠️ error => ", response);
        console.log("☠️ error => ", headers.errormsg);
      },
    });
  });
}

/**
 * @description
 * La fonction `_3DSwym_getSWYMIdea` est utilisée pour récupérer une idée SWYM à l'aide de son ID.
 * @param {String} [idPost] - L'identifiant de la publication, de l'idée que vous souhaitez récupérer depuis la plateforme 3DSwym.
 *  Il est défini sur la valeur par défaut "templateIdeaId" au cas où aucun
 * identifiant spécifique n'est fourni. "templateIdeaId" est basé sur le tenant courant et post sur la communauté "STATUT PROJETS - Phase commerciale" (tenant PIVETEAU TEST) ou "STATUT PROJETS - Phase commerciale" (tenant PIVETEAU)
 * @param {Callback}[onDone] - Le paramètre `onDone` est une fonction de rappel qui sera appelée lorsque la
 * requête sera terminée avec succès. Il prend un argument, «info», qui contient les données de
 * réponse du serveur.
 * @param {Callback}[onError] - Le paramètre `onError` est une fonction de rappel qui sera appelée s'il y a une
 * erreur lors de l'exécution de la fonction `_3DSwym_getSWYMIdea`. Il vous permet de gérer toutes les
 * erreurs qui surviennent et d'effectuer toutes les actions nécessaires.
 */
export function _3DSwym_getSWYMIdea(
  idPost = "",
  onDone = undefined,
  onError = undefined,
) {
  const store = mainStore();
  const { _3DSwym } = store;
  // Tenant PIVETEAU TEST template id || tenant PIVETEAU PROD
  const templateIdeaId =
    store.currentTenant.toLowerCase() === "r1132101716373"
      ? "tFtz0G4MR6qNtKgJjNfTog"
      : store.currentTenant.toLowerCase() === "r1132101286859"
      ? "Qpv3HN-tTDOsU-7_c5DnDg"
      : "Template_d'idée_à_créer"; // template créer à la creation d'une Affaire
  if (idPost === "") {
    idPost = templateIdeaId;
  }

  const URL = `${_3DSwym}/api/idea/get`;
  const datas = {
    params: {
      id: idPost,
    },
  };
  _3dswym_get_version((token) => {
    _httpCallAuthenticated(URL, {
      method: "POST",
      headers: {
        "Content-type": "application/json;charset=UTF-8",
        Accept: "application/json",
        "X-DS-SWYM-CSRFTOKEN": token.result.ServerToken,
      },
      data: JSON.stringify(datas),
      type: "json",
      onComplete(response) {
        const info = response;
        console.log("1 SWYMIdea ", info);
        store.getTemplateIdeaMSG(info.result.message);
        if (onDone) onDone(info);
      },
      onFailure(response) {
        if (onError) onError(response);
      },
    });
  });
}

/**
 * La fonction `_3DSwym_get_AllSWYMIdeas` récupère une liste d'idées à partir d'un point de terminaison
 * de l'API 3DSwym.
 * @param {Object} [data] - Le paramètre `data` est un objet qui contient les propriétés suivantes: ``community_id`` et `limit` (optionnel, par défaut 50 (50 premiers idées))
 * @param {Callback} [onDone] - Le paramètre `onDone` est une fonction de rappel qui sera appelée lorsque la
 * requête API sera terminée avec succès. Il prend un argument, « info », qui correspond aux données de
 * réponse de l'API.
 * @param {Callback} [onError] - Le paramètre `onError` est une fonction de rappel qui sera appelée s'il y a une
 * erreur lors de l'exécution de la fonction `_3DSwym_get_AllSWYMIdeas`. Il vous permet de gérer toutes
 * les erreurs qui surviennent et d'effectuer toutes les actions nécessaires.
 */
export function _3DSwym_get_AllSWYMIdeas(
  data = dataTest,
  onDone = undefined,
  onError = undefined,
) {
  const store = mainStore();
  const { _3DSwym, currentTenant } = store;

  const URL = {
    uri: "/api/idea/list",
    comId: `/community_id/${
      currentTenant.toLowerCase() === "r1132101716373"
        ? data.community_id
        : "bgnIsG74SUWswyGzS6NC6g"
    }`,
    limit: `/limit/${data.limit ? data.limit : 50}`, // Si la limit n'est pas fournie, on la met à 50
  };
  const url = `${_3DSwym}${URL.uri}${URL.comId}${URL.limit}`;
  _3dswym_get_version((token) => {
    _httpCallAuthenticated(url, {
      method: "GET",
      headers: {
        "X-DS-SWYM-CSRFTOKEN": token.result.ServerToken,
      },

      onComplete(response) {
        const info = JSON.parse(response);
        console.log("all SWYMIdeas ", info);
        if (onDone) onDone(info);
      },
      onFailure(response) {
        if (onError) onError(response);
      },
    });
  });
}

function templateAffaireMessage() {
  const store = mainStore();
  const { templateIdeaMSG } = store;
  // TEMPLATE AFFAIRES
  if (templateIdeaMSG === "") {
    const message = `&lt;h2>&lt;u>INFORMATIONS AFFAIRE :&lt;/u>&lt;/h2>
  &lt;p>&lt;u>|⚠️&lt;em> Merci de respecter l&amp;#39;écriture des tags, en MAJUSCULES, nom complet, pas de caractères&lt;/em>&lt;/u>&lt;/p>
  &lt;p>&lt;u>&lt;em>|spéciaux, séparation par &amp;#34;_&amp;#34; si besoin !&lt;/em>&lt;/u>&lt;/p>
  &lt;p>&lt;strong>Référence client &lt;/strong>:  &lt;em>
  &lt;a data-predicate="ds6w:who" data-type="internal" class="s6m-tag-link s6m-link">CLIENT&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&lt;strong>Référence projet &lt;/strong>: &lt;em>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">NOM AFFAIRE&lt;/a> 
  &lt;a data-predicate="ds6w:where" data-type="internal" class="s6m-tag-link s6m-link">VILLE&lt;/a> 
  &lt;a data-predicate="ds6w:where" data-type="internal" class="s6m-tag-link s6m-link">DPT&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&amp;#x1f4dd; &lt;strong>Base documentaire&lt;/strong> : LIEN projet&lt;/p>
  &lt;p>&amp;#x1f4dd; &lt;strong>Fiche COCLICO&lt;/strong> : LIEN projet&lt;em>&lt;strong>&lt;/strong>
  &lt;/em>&lt;/p>
  &lt;p>&lt;br />&lt;/p>
  &lt;table border="1">
  &lt;tbody>
  &lt;tr>&lt;td>&lt;strong>Description projet &lt;/strong>:
  &lt;br />&lt;br />&lt;/td>&lt;/tr>
  &lt;/tbody>
  &lt;/table>
  &lt;p>&lt;br />&lt;/p>
  &lt;p>&lt;br />&lt;/p>
  &lt;p>&lt;strong>Produit :&lt;em> &lt;/em>&lt;/strong>&lt;em>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Hexapli Usiné&lt;/a>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Hexapli MP&lt;/a>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Lamwood&lt;/a>
  &lt;/em>&lt;/p>
  &lt;p>&lt;strong>Type de Bâtiment :&lt;/strong>&lt;em>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Logements&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">BUP&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">ERP&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Plateforme Logistique&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&lt;strong>Essence :&lt;/strong> &lt;em>
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">DOUGLAS&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">PIN&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">MIXTE&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">EPICEA&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&lt;strong>Qualité : &lt;/strong>&lt;em>
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">NVI&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">VI1F&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">VI2F&lt;/a> 
  &lt;/em>&lt;strong>&lt;/strong>&lt;/p>
  &lt;p>&lt;strong>Traitement : &lt;/strong>&lt;em>
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">PARKA&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">CT2&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&lt;strong>Type de Paroi : &lt;/strong>&lt;em>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Murs Intérieurs&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Murs Extérieurs&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Planchers&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Couverture&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&lt;em>
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Etanchéité Accessible&lt;/a> 
  &lt;a data-predicate="ds6w:what" data-type="internal" class="s6m-tag-link s6m-link">Etanchéité Non-Accessible&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;p>&lt;strong>Hauteur Dernier Plancher :&lt;/strong>&lt;em>&lt;strong> &lt;/strong> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">Hauteur &amp;lt;8m&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">8m&amp;lt; Hauteur &amp;lt;28m&lt;/a> 
  &lt;a data-predicate="ds6w:how" data-type="internal" class="s6m-tag-link s6m-link">28m&amp;lt; Hauteur &amp;lt;50m&lt;/a> 
  &lt;/em>&lt;/p>
  &lt;h2>&lt;br />&lt;/h2>
  &lt;h2>&lt;u>EQUIPE PIVETEAU :&lt;/u>&lt;/h2>
  &lt;table border="1">
  &lt;tbody>
  &lt;tr>&lt;td>&lt;strong>Chargé d&amp;#39;Affaires&lt;/strong>&lt;/td>&lt;td>&lt;br />&lt;/td>&lt;/tr>
  &lt;tr>&lt;td>&lt;strong>Service études de prix&lt;/strong>&lt;/td>&lt;td>&lt;br />&lt;/td>&lt;/tr>
  &lt;/tbody>&lt;/table>
  &lt;p>
  &lt;/p>`;
    return message;
  } else {
    return templateIdeaMSG;
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_3DSpace_Create_Doc">_3DSpace_Create_Doc</a></li><li><a href="global.html#_3DSpace_csrf">_3DSpace_csrf</a></li><li><a href="global.html#_3DSpace_download_doc">_3DSpace_download_doc</a></li><li><a href="global.html#_3DSpace_download_multidoc">_3DSpace_download_multidoc</a></li><li><a href="global.html#_3DSpace_file_update">_3DSpace_file_update</a></li><li><a href="global.html#_3DSpace_file_update_csr">_3DSpace_file_update_csr</a></li><li><a href="global.html#_3DSpace_file_url">_3DSpace_file_url</a></li><li><a href="global.html#_3DSpace_file_url_csr">_3DSpace_file_url_csr</a></li><li><a href="global.html#_3DSpace_get_csrf">_3DSpace_get_csrf</a></li><li><a href="global.html#_3DSpace_get_docInfo">_3DSpace_get_docInfo</a></li><li><a href="global.html#_3DSpace_get_downloadTicket_multidoc">_3DSpace_get_downloadTicket_multidoc</a></li><li><a href="global.html#_3DSpace_get_securityContexts">_3DSpace_get_securityContexts</a></li><li><a href="global.html#_3DSpace_lifecycle_changeRevision">_3DSpace_lifecycle_changeRevision</a></li><li><a href="global.html#_3DSpace_lifecycle_changeState">_3DSpace_lifecycle_changeState</a></li><li><a href="global.html#_3DSpace_lifecycle_getGraph">_3DSpace_lifecycle_getGraph</a></li><li><a href="global.html#_3DSpace_lifecycle_getNextRevision">_3DSpace_lifecycle_getNextRevision</a></li><li><a href="global.html#_3DSpace_lifecycle_getNextStates">_3DSpace_lifecycle_getNextStates</a></li><li><a href="global.html#_3DSwym_getAllNews">_3DSwym_getAllNews</a></li><li><a href="global.html#_3DSwym_getFamiliarPeople">_3DSwym_getFamiliarPeople</a></li><li><a href="global.html#_3DSwym_getSWYMIdea">_3DSwym_getSWYMIdea</a></li><li><a href="global.html#_3DSwym_get_AllSWYMIdeas">_3DSwym_get_AllSWYMIdeas</a></li><li><a href="global.html#_3DSwym_get_currentUser">_3DSwym_get_currentUser</a></li><li><a href="global.html#_3DSwym_get_findUser">_3DSwym_get_findUser</a></li><li><a href="global.html#_3DSwym_get_version">_3DSwym_get_version</a></li><li><a href="global.html#_3dSwym_buildDirectMessage">_3dSwym_buildDirectMessage</a></li><li><a href="global.html#_3dSwym_deleteIdea">_3dSwym_deleteIdea</a></li><li><a href="global.html#_3dSwym_findCommunityToInstantMSG">_3dSwym_findCommunityToInstantMSG</a></li><li><a href="global.html#_3dSwym_postIdea">_3dSwym_postIdea</a></li><li><a href="global.html#_3dSwym_sendMessageData">_3dSwym_sendMessageData</a></li><li><a href="global.html#_getPlateformInfos">_getPlateformInfos</a></li><li><a href="global.html#_getPlatformServices">_getPlatformServices</a></li><li><a href="global.html#_httpCallAuthenticated">_httpCallAuthenticated</a></li><li><a href="global.html#_setDraggable">_setDraggable</a></li><li><a href="global.html#_setDroppable">_setDroppable</a></li><li><a href="global.html#_setupTagger">_setupTagger</a></li><li><a href="global.html#compass_getListAdditionalApps">compass_getListAdditionalApps</a></li><li><a href="global.html#createUserGroups">createUserGroups</a></li><li><a href="global.html#dataMixing">dataMixing</a></li><li><a href="global.html#deleteUserGroups">deleteUserGroups</a></li><li><a href="global.html#findAdresse">findAdresse</a></li><li><a href="global.html#getActiveServices">getActiveServices</a></li><li><a href="global.html#getAllContextSecurity">getAllContextSecurity</a></li><li><a href="global.html#getCSRFToken">getCSRFToken</a></li><li><a href="global.html#getCommunes">getCommunes</a></li><li><a href="global.html#getComplementUG">getComplementUG</a></li><li><a href="global.html#getDataFrom3DSpace">getDataFrom3DSpace</a></li><li><a href="global.html#getDataFromGouvFr">getDataFromGouvFr</a></li><li><a href="global.html#getDatasByTenant">getDatasByTenant</a></li><li><a href="global.html#getDatasFrom3DSpace">getDatasFrom3DSpace</a></li><li><a href="global.html#getDownloadDocument">getDownloadDocument</a></li><li><a href="global.html#getUserGroupsList">getUserGroupsList</a></li><li><a href="global.html#getUsersGroupRules">getUsersGroupRules</a></li><li><a href="global.html#get_3DSpace_csrf">get_3DSpace_csrf</a></li><li><a href="global.html#patchUserGroups">patchUserGroups</a></li><li><a href="global.html#patchUserGroupsControl">patchUserGroupsControl</a></li><li><a href="global.html#pushDataIn3DSpace">pushDataIn3DSpace</a></li><li><a href="global.html#readUserGroupControl">readUserGroupControl</a></li><li><a href="global.html#updateEvent">updateEvent</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Jan 12 2024 10:06:45 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
